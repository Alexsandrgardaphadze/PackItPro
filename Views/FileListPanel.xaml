<!-- Views/FileListPanel.xaml - FULL FIXED VERSION WITH STATUS CONVERTER -->
<UserControl x:Class="PackItPro.Views.FileListPanel"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:converters="clr-namespace:PackItPro.Converters"
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800">

    <!-- RESOURCES -->
    <UserControl.Resources>
        <!-- Pulsing animation for empty state icon -->
        <Storyboard x:Key="PulseAnimation" RepeatBehavior="Forever">
            <DoubleAnimation Storyboard.TargetName="EmptyStateIcon"
                           Storyboard.TargetProperty="Opacity"
                           From="0.4" To="1.0" 
                           Duration="0:0:2"
                           AutoReverse="True">
                <DoubleAnimation.EasingFunction>
                    <SineEase EasingMode="EaseInOut"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
        </Storyboard>

        <!-- STATUS TO BACKGROUND CONVERTER -->
        <converters:StatusToBackgroundConverter x:Key="StatusToBackground"/>
    </UserControl.Resources>

    <!-- MAIN BORDER -->
    <Border Margin="0,0,10,0"
            BorderBrush="{StaticResource AppBorderColor}"
            BorderThickness="1"
            CornerRadius="12"
            Background="{StaticResource AppPanelColor}"
            AllowDrop="True"
            Drop="UserControl_Drop"
            DragEnter="UserControl_DragEnter"
            DragLeave="UserControl_DragLeave">

        <Grid>
            <!-- Subtle gradient overlay for depth -->
            <Border CornerRadius="12" Opacity="0.03">
                <Border.Background>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                        <GradientStop Color="White" Offset="0"/>
                        <GradientStop Color="Transparent" Offset="1"/>
                    </LinearGradientBrush>
                </Border.Background>
            </Border>

            <!-- EMPTY STATE -->
            <Grid Name="EmptyDropState" 
                  Visibility="{Binding HasFiles, Converter={StaticResource InverseBoolToVisibility}}">
                <Grid.Triggers>
                    <EventTrigger RoutedEvent="Loaded">
                        <BeginStoryboard Storyboard="{StaticResource PulseAnimation}"/>
                    </EventTrigger>
                </Grid.Triggers>

                <!-- Main Content -->
                <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Margin="30">
                    <Border x:Name="EmptyStateIcon" Width="90" Height="90"
                            Background="{StaticResource AppPanelHoverColor}" CornerRadius="45"
                            HorizontalAlignment="Center" Margin="0,0,0,20">
                        <TextBlock Text="📦" FontSize="48" HorizontalAlignment="Center" VerticalAlignment="Center"
                                   Foreground="{StaticResource AppPrimaryColor}"/>
                    </Border>

                    <TextBlock Text="Drop Your Files Here" FontSize="20" FontWeight="SemiBold"
                               Foreground="{StaticResource AppTextColor}" HorizontalAlignment="Center" TextAlignment="Center"
                               FontFamily="Segoe UI" Margin="0,0,0,6"/>

                    <TextBlock FontSize="13" Foreground="{StaticResource AppTextTertiaryColor}" 
                               HorizontalAlignment="Center" TextAlignment="Center" LineHeight="20" FontFamily="Segoe UI"
                               Margin="0,0,0,18">
                        <Run Text="Drag and drop files or folders here"/>
                        <LineBreak/>
                        <Run Text="Maximum 20 files per package" FontSize="11"/>
                    </TextBlock>

                    <Button Content="Browse Files" Style="{StaticResource Win11Button}" 
                            Command="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=DataContext.BrowseFilesCommand}"
                            Height="40" Padding="24,0" FontSize="14" FontWeight="SemiBold" Cursor="Hand"/>
                </StackPanel>
            </Grid>

            <!-- FILE LIST -->
            <ListView Name="FileListView"
                      Background="Transparent"
                      BorderThickness="0"
                      Margin="15"
                      Visibility="{Binding HasFiles, Converter={StaticResource BoolToVisibility}}"
                      ItemsSource="{Binding Items}"
                      ItemContainerStyle="{StaticResource FileItemStyle}"
                      ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                <ListView.View>
                    <GridView>
                        <!-- Icon Column -->
                        <GridViewColumn Header="📄" Width="35" HeaderContainerStyle="{StaticResource GridViewColumnHeaderStyle}">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding FileIcon}" FontSize="16" FontFamily="Segoe UI Emoji" 
                                               HorizontalAlignment="Center" Foreground="{StaticResource AppTextColor}"/>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>

                        <!-- File Name Column -->
                        <GridViewColumn Header="File Name" Width="250" HeaderContainerStyle="{StaticResource GridViewColumnHeaderStyle}">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding FileName}" FontSize="12" FontFamily="Segoe UI"
                                               TextTrimming="CharacterEllipsis" ToolTip="{Binding FileName}" 
                                               Foreground="{StaticResource AppTextColor}"/>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>

                        <!-- Size Column -->
                        <GridViewColumn Header="Size" Width="90" HeaderContainerStyle="{StaticResource GridViewColumnHeaderStyle}">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding Size}" FontSize="11" FontFamily="Consolas"
                                               Foreground="{StaticResource AppTextSecondaryColor}"/>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>

                        <!-- Status Column -->
                        <GridViewColumn Header="Status" Width="120" HeaderContainerStyle="{StaticResource GridViewColumnHeaderStyle}">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <Border Background="{Binding Status, Converter={StaticResource StatusToBackground}}"
                                            CornerRadius="4" Padding="6,3" HorizontalAlignment="Left">
                                        <TextBlock Text="{Binding Status}" FontSize="10" FontWeight="SemiBold" 
                                                   Foreground="Black" FontFamily="Segoe UI"/>
                                    </Border>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>

                        <!-- Remove Button Column -->
                        <GridViewColumn Header="" Width="35" HeaderContainerStyle="{StaticResource GridViewColumnHeaderStyle}">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <Button Content="✕" Width="22" Height="22" FontSize="11" FontWeight="Bold"
                                            Foreground="{StaticResource AppTextTertiaryColor}" Background="Transparent"
                                            BorderThickness="0" Cursor="Hand"
                                            Command="{Binding DataContext.RemoveFileCommand, RelativeSource={RelativeSource AncestorType=ListView}}"
                                            CommandParameter="{Binding}"/>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>
                    </GridView>
                </ListView.View>
            </ListView>
        </Grid>
    </Border>
</UserControl>
